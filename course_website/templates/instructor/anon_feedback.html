<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Instructor - Anonymous Feedback</title>
    <link href="{{ url_for('static', filename='css/assignments.css') }}" rel="stylesheet" type="text/css">
</head>
<body>

<div class="background"></div>

<input type="checkbox" id="dark-mode-toggle">
<label for="dark-mode-toggle" class="dark-mode-label">Dark Mode</label>

<!-- Left Navigation Bar -->
<div class="leftnavigation">
    <ul>
        <li><a href="{{ url_for('instructor_dashboard') }}">Home ğŸ </a></li>
        <li><a href="{{ url_for('instructor_syllabus') }}">SyllabusğŸš€</a></li>
        <li><a href="{{ url_for('instructor_calendar') }}">CalendarğŸ—“ï¸</a></li>
        <li><a href="https://piazza.com/class/m5fmz9kzjo83yk">PiazzağŸ’¡</a></li>
        <li><a href="https://markus2.utsc.utoronto.ca/courses/34/assignments">MarkusğŸ—‚ï¸</a></li>
        <li><a href="{{ url_for('instructor_lectures') }}">LecturesğŸ‘©â€ğŸ«</a></li>
        <li><a href="{{ url_for('instructor_labs') }}">LabsğŸ‘©â€ğŸ’»</a></li>
        <li><a href="{{ url_for('instructor_assignments') }}">Assignmentsâœï¸</a></li>
        <li><a href="{{ url_for('instructor_resources') }}">Course TeamğŸ™‹â€â™€ï¸ğŸ™‹â€â™€ï¸</a></li>
        <li><a href="{{ url_for('instructor_feedback') }}"><span>FeedbackğŸ˜‰</span></a></li>
        <li><a href="{{ url_for('student_grades') }}">GradesğŸ“Š</a></li>
        <li><a href="{{ url_for('view_regrade_requests') }}">RegradeğŸ“</a></li>
    </ul>
</div>

<header class="assignment-header">
    <h1>ğŸ“¢ Anonymous Feedback</h1>
    <p>Hi {{ username }}, here are your students' anonymous feedbacks.</p>
</header>

<div class="assignments-container">
    {% if feedbacks %}
        {% for fb in feedbacks %}
        <details class="assignment-card" id="feedback-{{ fb.id }}">
            <summary>ğŸ“ Feedback ID #{{ fb.id }} - Status: <span class="status">{{ fb.status }}</span></summary>
            <ul>
                <li><strong>â¤ï¸ Like about teaching:</strong> {{ fb.like_teaching }}</li>
                <li><strong>ğŸ› ï¸ Improve in teaching:</strong> {{ fb.improve_teaching }}</li>
                <li><strong>ğŸ§ª Like about labs:</strong> {{ fb.like_labs }}</li>
                <li><strong>ğŸ”§ Improve in labs:</strong> {{ fb.improve_labs }}</li>
                {% if fb.additional %}
                <li><strong>â• Additional comments:</strong> {{ fb.additional }}</li>
                {% endif %}
            </ul>
        
            {% if fb.status == 'open' %}
            <button onclick="markReviewed({{ fb.id }})">âœ… Mark as Reviewed</button>
            {% endif %}
        </details>              
        {% endfor %}
    {% else %}
        <p>No feedback yet ğŸ˜…</p>
    {% endif %}
</div>

<!-- Footer -->
<footer>
    <p>Â© 2025 CSCB20 Course Website | <a href="https://web.cs.toronto.edu/">Faculty of Computer Science at UofT</a></p>
    <p>Site design by Shuqing Tu and Yiqin Gao</p>
</footer>
<script>
    function markReviewed(feedbackId) {
        fetch('/instructor/update_feedback_status', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ feedback_id: feedbackId })
        })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                const card = document.getElementById(`feedback-${feedbackId}`);
                const statusSpan = card.querySelector('.status');
                statusSpan.textContent = 'reviewed';
    
                // ç§»é™¤æŒ‰é’®
                const button = card.querySelector('button');
                if (button) button.remove();
    
                // å»¶è¿Ÿä¸€ç‚¹è®©ç”¨æˆ·çœ‹è§â€œå·²æ›´æ–°â€ï¼Œç„¶åç§»åŠ¨
                setTimeout(() => {
                    card.parentNode.appendChild(card); // ä¸‹æ²‰
                }, 500);
            } else {
                alert("Failed to update status");
            }
        });
    }
    </script>
    
</body>
</html>
