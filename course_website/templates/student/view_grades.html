
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CSCB20 - View Your Grades</title>
    <link href="{{ url_for('static', filename='css/assignments.css') }}" rel="stylesheet" type="text/css">
</head>

<body>

    <div class="background"></div>

    <input type="checkbox" id="dark-mode-toggle">
    <label for="dark-mode-toggle" class="dark-mode-label">Dark Mode</label>

    <!-- Left Navigation Bar -->
    <div class="leftnavigation">
        <ul>
          <li><a href="{{ url_for('student_dashboard') }}">Home ğŸ </a></li>
          <li><a href="{{ url_for('student_syllabus') }}">SyllabusğŸš€</a></li>
          <li><a href="{{ url_for('student_calendar') }}">CalendarğŸ—“ï¸</a></li>
          <li><a href="https://piazza.com/class/m5fmz9kzjo83yk">PiazzağŸ’¡</a></li>
          <li><a href="https://markus2.utsc.utoronto.ca/courses/34/assignments">MarkusğŸ—‚ï¸</a></li>
          <li><a href="{{ url_for('student_lectures') }}">LecturesğŸ‘©â€ğŸ«</a></li>
          <li><a href="{{ url_for('student_labs') }}">LabsğŸ‘©â€ğŸ’»</a></li>
          <li><a href="{{ url_for('student_assignments') }}">Assignmentsâœï¸</a></li>
          <li><a href="{{ url_for('student_resources') }}">Course TeamğŸ™‹â€â™€ï¸ğŸ™‹â€â™€ï¸</a></li>
          <li><a href="{{ url_for('student_feedback') }}">Anon FeedbackğŸ˜‰</a></li>
          <li><a href="{{ url_for('view_grades') }}"><span>GradesğŸ“Š</span></a></li>
        </ul>
    </div>

    <!-- Header -->
    <header class="assignment-header">
      <h1>ğŸ“‹ Your Current Grades</h1>
      <p>Welcome {{ username }}, here is your current progress:</p>
  </header>

  {% if not grades['Assignments'] and not grades['Labs'] and not grades['Midterm'] and not grades['Final'] %}
      <p style="text-align:center; font-size: 18px; margin-top: 30px;">
          ğŸ“­ No grades available yet. Please check back later!
      </p>
  {% endif %}

  <!-- Grades Display Section -->
  <div class="assignments-container">
      
      {% if grades['Assignments'] %}
      <details class="assignment-card">
          <summary>âœï¸ Assignments</summary>
          {% for g in grades['Assignments'] %}
          <div style="margin-bottom: 15px;">
              <p><strong>{{ g.name }}</strong>: {{ g.grade }}/100</p>
              <div class="remark-section" data-assignment="{{ g.name }}">
                  <button onclick="showRemarkForm(this)">ğŸ“ Submit Remark Request</button>
                  <div class="remark-form" style="display: none;">
                      <textarea placeholder="Enter your reason..." rows="2"></textarea>
                      <button onclick="submitRemarkRequest(this, '{{ g.name }}')">Submit</button>
                      <p class="remark-status" style="color: green;"></p>
                  </div>
              </div>
          </div>
          {% for r in regrades.get(g.name, []) %}
          <p class="remark-status-line">
              <strong>ğŸ“Œ Remark Status:</strong>
              <span class="status-{{ r.status | lower }}">
                {{ r.status }}
              </span>
              â€” "{{ r.message }}"
            </p>              
          {% endfor %}
          {% endfor %}
        </details>
        {% endif %}

      {% if grades['Labs'] %}
      <details class="assignment-card">
          <summary>ğŸ‘©â€ğŸ’» Labs</summary>
          {% for g in grades['Labs'] %}
          <div style="margin-bottom: 15px;">
              <p><strong>{{ g.name }}</strong>: {{ g.grade }}/100</p>
              <div class="remark-section" data-assignment="{{ g.name }}">
                  <button onclick="showRemarkForm(this)">ğŸ“ Submit Remark Request</button>
                  <div class="remark-form" style="display: none;">
                      <textarea placeholder="Enter your reason..." rows="2"></textarea>
                      <button onclick="submitRemarkRequest(this, '{{ g.name }}')">Submit</button>
                      <p class="remark-status" style="color: green;"></p>
                  </div>
              </div>
          </div>
          {% for r in regrades.get(g.name, []) %}
          <p class="remark-status-line">
              <strong>ğŸ“Œ Remark Status:</strong>
              <span class="status-{{ r.status | lower }}">
                {{ r.status }}
              </span>
              â€” "{{ r.message }}"
            </p>              
          {% endfor %}
          {% endfor %}
      </details>
      {% endif %}
      
      {% if grades['Midterm'] %}
      <details class="assignment-card">
          <summary>ğŸ“– Midterm</summary>
          {% for g in grades['Midterm'] %}
          <div style="margin-bottom: 15px;">
              <p><strong>{{ g.name }}</strong>: {{ g.grade }}/100</p>
              <div class="remark-section" data-assignment="{{ g.name }}">
                  <button onclick="showRemarkForm(this)">ğŸ“ Submit Remark Request</button>
                  <div class="remark-form" style="display: none;">
                      <textarea placeholder="Enter your reason..." rows="2"></textarea>
                      <button onclick="submitRemarkRequest(this, '{{ g.name }}')">Submit</button>
                      <p class="remark-status" style="color: green;"></p>
                  </div>
              </div>
          </div>
          {% for r in regrades.get(g.name, []) %}
          <p class="remark-status-line">
              <strong>ğŸ“Œ Remark Status:</strong>
              <span class="status-{{ r.status | lower }}">
                {{ r.status }}
              </span>
              â€” "{{ r.message }}"
            </p>
            
          {% endfor %}
          {% endfor %}
      </details>
      {% endif %}

      {% if grades['Final'] %}
      <details class="assignment-card">
          <summary>ğŸ“š Final Exam</summary>
          {% for g in grades['Final'] %}
              <div style="margin-bottom: 15px;">
              <p><strong>{{ g.name }}</strong>: {{ g.grade }}/100</p>
              <div class="remark-section" data-assignment="{{ g.name }}">
                  <button onclick="showRemarkForm(this)">ğŸ“ Submit Remark Request</button>
                  <div class="remark-form" style="display: none;">
                      <textarea placeholder="Enter your reason..." rows="2"></textarea>
                      <button onclick="submitRemarkRequest(this, '{{ g.name }}')">Submit</button>
                      <p class="remark-status" style="color: green;"></p>
                  </div>
              </div>
          </div>
          {% for r in regrades.get(g.name, []) %}
          <p class="remark-status-line">
              <strong>ğŸ“Œ Remark Status:</strong>
              <span class="status-{{ r.status | lower }}">
                {{ r.status }}
              </span>
              â€” "{{ r.message }}"
            </p>              
          {% endfor %}
          {% endfor %}
      </details>
      {% endif %}
  </div>

  <!-- Footer -->
  <footer>
      <p>Â© 2025 CSCB20 Course Website | <a href="https://web.cs.toronto.edu/">Faculty of Computer Science at UofT</a></p>
      <p>Site design by Shuqing Tu and Yiqin Gao</p>
  </footer>

  <script>
      function showRemarkForm(button) {
        const form = button.nextElementSibling;
        form.style.display = form.style.display === "none" ? "block" : "none";
      }
      
      function submitRemarkRequest(submitButton, assignmentName) {
        const formDiv = submitButton.parentElement;
        const textarea = formDiv.querySelector("textarea");
        const statusText = formDiv.querySelector(".remark-status");
        const reason = textarea.value.trim();
      
        if (!reason) {
          alert("Please enter a reason.");
          return;
        }
      
        fetch("/submit_remark", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            assignment: assignmentName,
            message: reason
          })
        })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            statusText.textContent = "âœ… Remark request submitted successfully!";
            textarea.value = "";
            const newStatus = document.createElement('p');
            newStatus.className = "remark-status-line";
            newStatus.innerHTML = `<strong>Remark Status:</strong> 
            <span style="color: orange;">${data.status}</span> â€” "${data.message}"`;
            formDiv.parentElement.appendChild(newStatus);
          } else {
            statusText.textContent = "âŒ Failed to submit request.";
          }
        }
      );
      }
</script>
      
</body>
</html>
